generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  schemas  = ["core", "hsptl", "lab", "pharmacy", "user"]
}

model Doctor {
  id           Int           @id @default(autoincrement())
  name         String
  departmentId Int
  userId       Int?          @unique
  appointments Appointment[]
  department   department    @relation(fields: [departmentId], references: [id])
  user         User?         @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "doctor_userid_fkey")
  patients     Patient[]

  @@map("doctor")
  @@schema("hsptl")
}

model Patient {
  id           Int           @id @default(autoincrement())
  name         String
  doctorId     Int
  userId       Int           @unique
  appointments Appointment[]
  doctor       Doctor        @relation(fields: [doctorId], references: [id])
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "patient_userid_fkey")
  labTests     LabTest[]

  @@map("patient")
  @@schema("hsptl")
}

model Appointment {
  id        Int      @id @default(autoincrement())
  doctorId  Int
  patientId Int
  date      DateTime
  doctor    Doctor   @relation(fields: [doctorId], references: [id])
  patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@map("appointment")
  @@schema("hsptl")
}

model Medicine {
  id    Int    @id @default(autoincrement())
  name  String
  stock Int
  price Float

  @@map("medicine")
  @@schema("pharmacy")
}

model LabTest {
  id        Int      @id @default(autoincrement())
  patientId Int
  type      String
  result    String?
  takenAt   DateTime @default(now())
  patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@map("lab_test")
  @@schema("lab")
}

model department {
  id       Int      @id @default(autoincrement())
  deptName String   @unique
  doctors  Doctor[]

  @@map("department")
  @@schema("core")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  role      Role     @default(PATIENT)
  createdAt DateTime @default(now())
  doctor    Doctor?
  patient   Patient?

  @@map("user")
  @@schema("core")
}

enum Role {
  ADMIN
  DOCTOR
  PATIENT

  @@schema("core")
}
